<!DOCTYPE html>
<html>
<head>
    <title>User Profile</title> 
    <link rel=" stylesheet"  href="user.css">
</head>

<body>
    <header>
        <% if (typeof username !== 'undefined') { %>
            <div class="header">
                <h1 class="title">Welcome Back, <%= username %>!</h1>
            </div>
        <% } else { %>
            <div class="header">
            <p><a href="/login">Login</a></p>
            </div>
        <% } %>
    </header>
    <nav>
        <ul>
            <li><a href="/main">Home</a></li> 
            <li><a href="/about">About</a></li>
            <li><a href="/resources">Resources</a></li>
            <li><a href="/calender">Calendar</a></li>
            <li><a href="/journal">Journal</a></li>
    
        </ul>
    </nav>
    <main>
        <div class="collapsible-section">
            <button class="collapsible">Collapsible List Item 1</button>
            <div class="content">
                <p>This is the content for item 1.</p>
            </div>
    
            <button class="collapsible">Collapsible List Item 2</button>
            <div class="content">
                <p>This is the content for item 2.</p>
            </div>
    
            <button class="collapsible">Collapsible List Item 3</button>
            <div class="content">
                <p>This is the content for item 3.</p>
            </div>
        </div>
        <h2>Settings</h2>
        <div class="settings-content">
            <button onclick="toggleForm('usernameForm')">Change Username</button>
            <form id="usernameForm" action="/change-username" method="POST" style="display:none;">
                <label for="newUsername">New Username:</label>
                <input type="text" id="newUsername" name="newUsername" required>
                <button type="submit">Update Username</button>
            </form>

            <button onclick="toggleForm('passwordForm')">Change Password</button>
            <form id="passwordForm" action="/change-password" method="POST" style="display:none;">
                <label for="newPassword">New Password:</label>
                <input type="password" id="newPassword" name="newPassword" required>
                <button type="submit">Update Password</button>
            </form>

            <button><a href="/logout">Logout</a></button>
        </div>
    </main>
    
    <script>
        var collapsibles = document.querySelectorAll(".collapsible");
    
        collapsibles.forEach(function(collapsible) {
            collapsible.addEventListener("click", function() {
                this.classList.toggle("active");
    
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            });
        });

        function toggleForm(formId) {
            var form = document.getElementById(formId);
            if (form.style.display === "block") {
                form.style.display = "none";
            } else {
                form.style.display = "block";
            }
        }
    const changePasswordForm = document.getElementById("changePasswordForm");

    // Add an event listener for form submission
    changePasswordForm.addEventListener("submit", function (event) {
        event.preventDefault();  // Prevent the default form submission

        // Get the form data
        const formData = new FormData(changePasswordForm);
        const newPassword = formData.get("newPassword");

        // Send an AJAX request to the server to update the password
        fetch("/change-password", {
            method: "POST",
            body: new URLSearchParams(formData),  // Serialize the form data
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
        })
        .then(response => response.text())
        .then((data) => {
            // Show a message to the user
            alert("Password successfully updated!");

            // Force page reload
            window.location.reload(true);  // Reload the page from the server
        })
        .catch((error) => {
            console.error("Error updating password:", error);
            alert("Something went wrong. Please try again.");
        });
    });
    </script>
</body>
</html>


